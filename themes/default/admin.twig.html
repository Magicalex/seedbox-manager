{% extends 'layout.twig.html' %}

{% block content %}
    <h1 class="page-header dashboard"><i class="glyphicon glyphicon-cog"></i> Espace administration</h1>
    {{ notifications.admin_update_ini.0 }}

    {% set notification_admin_update_ini = notifications.admin_update_ini.0 %}
    {% if notifications.admin_update_ini is defined and notification_update_ini_file == true %}
    <div class="alert alert-success">La configuration de l'utilisateur <strong>{{ user.name }}</strong> a été mise à jour avec succès.</div>
    {% elseif notifications.admin_update_ini is defined and notification_update_ini_file == false %}
    <div class="alert alert-danger">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        Impossible de mettre à jour la configuration de l'utilisateur <strong>{{ user.name }}</strong> !
    </div>
    {% endif %}

    {% if post.deleteUserName is defined and LogDeleteUser.error is empty %}
    <div class="alert alert-success">
        <h4>Les fichiers de configuration de l'utilisateur <strong>{{ post.deleteUserName }}</strong> ont été supprimé avec succès.</h4>
        <ul class="text-success">
        {% for LogDeleteFile in LogDeleteUser.log %}
            <li>{{ LogDeleteFile }}</li>
        {% endfor %}
        </ul>
    </div>
    {% elseif post.deleteUserName %}
    <div class="alert alert-danger">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <h4>Impossible de supprimer l'utilisateur <strong>{{ post.deleteUserName }}</strong>.</h4>
        <ul class="text-danger">
        {% for LogDeleteFile in LogDeleteUser.error %}
            <li>{{ LogDeleteFile }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    <section class="row">
        <article class="col-md-6">
            <div class="well well-sm">
                <h4 class="titre-head"><i class="glyphicon glyphicon-th-list"></i> Configuration de l'utilisateur : <strong>{{ user.name }}</strong></h4>
                <div class="trait"></div>
                <form method="post" action="/admin/update/{{ user.name }}" role="form">
                    <fieldset>
                        <legend>Généralité utilisateur</legend>
                        <div class="form-group">
                            <label for="user_directory">Dossier /home de l'utilisateur</label>
                            <input type="text" class="form-control" name="user_directory" id="user_directory" value="{{ user.user_directory }}">
                        </div>
                        <div class="form-group">
                            <label for="user_directory">Dossier scgi de l'utilisateur</label>
                            <input type="text" class="form-control" name="scgi_folder" id="scgi_folder" value="{{ user.scgi_folder }}">
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Barre de navigation</legend>
                        <label for="data_link" class="text-danger">
                            <i class="glyphicon glyphicon-warning-sign"></i>
                            Suivez correctement la syntaxe pour ajouter des liens
                        </label>
                        <textarea class="form-control" rows="3" name="data_link" id="data_link">{{ user.navbar_links }}</textarea>
                    </fieldset>
                    <fieldset>
                        <legend>Paramètre des serveurs FTP/sFTP</legend>
                        <div class="form-group">
                            <label for="port_ftp">Port ftp</label>
                            <input type="number" class="form-control" name="port_ftp" id="port_ftp" value="{{ user.portFtp }}">
                        </div>
                        <div class="form-group">
                            <label for="port_sftp">Port sftp</label>
                            <input type="number" class="form-control" name="port_sftp" id="port_sftp" value="{{ user.portSftp }}">
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Support</legend>
                        <div class="form-group">
                            <label for="adresse_mail">Adresse du support</label>
                            <input type="email" class="form-control" name="adresse_mail" id="adresse_mail" value="{{ user.supportMail }}">
                        </div>
                    </fieldset>
                    <p class="text-right fix-marg-input">
                        <input type="hidden" name="user" value="{{ user.name }}">
                        <input type="submit" name="submit" value="Enregistrer" class="btn btn-info">
                    </p>
                </form>
            </div>
        </article>
        <article class="col-md-6">
            <div class="well well-sm">
                <h4 class="titre-head"><i class="glyphicon glyphicon-th-list"></i> Administration : gestion utilisateurs</h4>
                <div class="trait"></div>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th><strong>#</strong></th>
                                <th><strong>Utilisateur</strong></th>
                                <th><strong>Modifier</strong></th>
                                <th><strong>Supprimer</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for user in user.get_all_users %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ user }}</td>
                            <td>
                                <a href="/admin/{{ user }}" class="btn btn-default btn-xs edit-btn-user">
                                    <i class="glyphicon glyphicon-edit"></i> éditer
                                </a>
                            </td>
                            <td>
                            {% if user != username %}
                            <a data-toggle="modal" class="popup-delete-user btn btn-danger btn-xs" data-user="{{ user }}" href="#delete-user">
                                <i class="glyphicon glyphicon-trash"></i> supprimer
                            </a>
                            {% else %}
                            <a class="popup-delete-user btn btn-danger btn-xs disabled">
                                <i class="glyphicon glyphicon-trash"></i> supprimer
                            </a>
                            {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </article>
    </section>
{% endblock %}

{% block modal %}
<div class="modal fade" id="delete-user" tabindex="-1" role="dialog" aria-labelledby="target-delete-user" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="target-delete-user"></h4>
            </div>
            <div class="modal-body">
                <p>&Ecirc;tes-vous sûr de vouloir supprimer la configuration de cette utilisateur ?</p>
                <p>Cette action est réversible.<br>Dès que votre utilisateur va se connecter les fichiers de configuration seront généré automatiquement (avec une configuration par défaut).</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                <form action="/admin/delete" method="post">
                    <input type="hidden" name="deleteUserName" id="deleteUserName">
                    <input type="submit" value="Supprimer" class="btn btn-danger">
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
